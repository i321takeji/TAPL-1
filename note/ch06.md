# 6章 項の名無し表現（Nameless Representation of Terms）

```toc
```
## はじめに
前章では，項を「束縛変数の名前の違いを除いて」扱った．

（例）
```mathjaxBlock
\begin{align}
\left.
  \begin{array}{ll}
  \mathtt{t}_{1} &=\lambda\mathtt{a}.\ \mathtt{a} \\
  \mathtt{t}_{2} &=\lambda\mathtt{b}.\ \mathtt{b}
  \end{array}
\right\}
\mathtt{t}_{1}と\mathtt{t}_{2}は束縛変数の名前が違うだけなので，
\mathtt{t}_{1}=\mathtt{t}_{2}
\end{align}
```

### 変数の出現に対する表現方法

1. 変数を記号的に表現する
代入の際に束縛変数を明示的に **フレッシュ** な名前に置き換える．
```mathjaxBlock
\begin{align}
                               & \underline{(\lambda\mathtt{x}.\ \mathtt{x}\ \mathbf{y})(\lambda\mathtt{y}.\ \mathtt{y})} & 項として存在できる \\
\longrightarrow\quad           & (\lambda\mathtt{y}.\ \mathtt{y}\ \mathbf{y})                                             & 変数捕獲が起きる   \\
\longrightarrow_{名前変更}\quad& (\lambda\mathtt{z}.\ \mathtt{z}\ \mathbf{y})                                                                  \\
\end{align}
```
2. 変数を記号的に表現する（1よりも厳しい）
    - 不変条件1: 束縛変数の名前はすべて互いに異なる
    `$(\lambda\underline{\mathtt{x}}.\ \mathtt{x})(\lambda\underline{\mathtt{x}}.\ \mathtt{x})$` ... だめ
    - 不変条件2: 使う可能性のあるどの自由変数とも異なる
    `$(\lambda\mathtt{x}.\ \mathtt{x}\ \underline{\mathtt{y}})(\lambda\underline{\mathtt{y}}.\ \mathtt{y})$` ... だめ
この慣習はBarendregtの慣習とも呼ばれ，任意の時点での「その場での」名前の付替えを許容しない．
しかし，安定ではない．なぜなら，代入操作は代入される項の複製を伴うから．
```mathjaxBlock
\begin{align}
                               & \underline{(\lambda\mathtt{x}.\ \mathtt{x}\ \mathtt{x})(\lambda\mathtt{y}.\ \mathtt{y})}                                      \\
\longrightarrow\quad           & (\lambda\underline{\mathtt{y}}.\ \mathtt{y})(\lambda\underline{\mathtt{y}}.\ \mathtt{y}) & 不変条件を回復するための処理が必要 \\
\longrightarrow_{名前変更}\quad&  (\lambda\mathtt{y}'.\ \mathtt{y}')(\lambda\mathtt{y}''.\ \mathtt{y}'')
\end{align}
```
3. 名前を変更する必要のない，変数および項の「標準の」表現を考える（ **名前をなくす** ）
→本書の方針
4. 明示的代入などの仕組みを導入することで，代入操作を避ける（ **代入をなくす** ）
5. 変数の使用を完全に避ける
コンビネータ論理を扱う．コンビネータとは自由変数を含まない項（閉じた項）のこと．
```mathjaxBlock
\begin{align}
                    & \underline{(\lambda\mathtt{x}.\ \mathtt{y}\ \mathtt{x}\ \mathtt{y})(\lambda\mathtt{y}.\ \mathtt{y})}    \\
\longrightarrow\quad& \lambda\mathtt{y}.\ (\lambda\mathbf{y}.\ \mathbf{y})\ \mathtt{y} & スコープが異なるから大丈夫なのかな？ \\
\end{align}
```

- 本書で3の表現方法を選ぶ理由
実装が間違っている場合に，微妙に失敗するのではなく，
**壊滅的に失敗** する傾向があるため．
すなわち，比較的早く間違いを検出し，修正できる．
定式化の方法として，Nicolas de Bruijn による技法を用いる．

## 6.1 項と文脈
アイデア！: 変数の出現を **名前** ではなく， **束縛子を直接指す** ことで項を表現

（例）

|通常の項                                                     |名無し項（内側から番号を振る）                            |
|:------------------------------------------------------------|:---------------------------------------------------------|
|`$\lambda\mathtt{x}.\ \mathtt{x}$`                           |`$\lambda.\ \mathtt{0}$`                                  |
|`$\lambda\mathtt{x}.\ \lambda{y}.\ (\mathtt{y}\ \mathtt{x})$`|`$\lambda.\lambda.\ \mathtt{1}\ (\mathtt{0}\ \mathtt{1})$`|

名無し項は，de Bruijn 項とも呼ばれる．
`$\lambda.\ \mathtt{0}$` の `$\mathtt{0}$` はde Bruijnインデックス（自然数）と呼ばれ，
コンパイラの人は静的距離とも呼ぶ．

### 定義 6.1.2
`$\mathcal{T}$` を以下の条件を満たす集合の最小の族 `$\{\mathcal{T}_{0}, \mathcal{T}_{1}, \mathcal{T}_{2}, \ldots\}$` とする．
1. `$0 \leq \mathtt{k} < n$` ならば `$\mathtt{k} \in \mathcal{T}_{n}$`
2. `$\mathtt{t}_{1} \in \mathcal{T}_{n}$` かつ `$n > 0$` ならば `$\lambda.\mathtt{t}_{1} \in \mathcal{T}_{n-1}$`
3. `$\mathtt{t}_{1} \in \mathcal{T}_{n}$` かつ `$\mathtt{t}_{2} \in \mathcal{T}_{n}$` ならば `$(\mathtt{t}_{1}\ \mathtt{t}_{2}) \in \mathcal{T}_{n}$`

（例）
```mathjaxBlock
\begin{align}
\mathcal{T}_{0}=& \quad \{\lambda.\mathtt{0},\ \lambda.\lambda.\mathtt{1},\ \ldots\}                                     & 自由変数0の集合 \\
\mathcal{T}_{1}=& \quad \{\lambda.\mathtt{x},\ \lambda.\lambda.\mathtt{y},\ \lambda.\mathtt{0}\ \mathtt{z}\ldots\}       & 自由変数1の集合 \\
\mathcal{T}_{2}=& \quad \{\lambda.\mathtt{x}\ \mathtt{y},\ \lambda.\mathtt{0},\ \lambda.\mathtt{z}\ \mathtt{y},\ \ldots\}& 自由変数2の集合 \\
                & \vdots                                                                                                 &                 \\
\mathcal{T}_{n}=& \quad \{\ldots\}                                                                                       & 自由変数nの集合 \\
\end{align}
```
