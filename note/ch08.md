# 8章 型付き算術式（Typed Arithmetic Expressions）

```toc
```

## 8.1 型
算術式の構文（図 3.2）

|項      |`$\mathtt{t}$`                                                                    |
|:-------|:---------------------------------------------------------------------------------|
|定数真  |`$\mathtt{true}$`                                                                 |
|定数偽  |`$\mathtt{false}$`                                                                |
|条件式  |`$\mathtt{if} \ \mathtt{t}\ \mathtt{then}\ \mathtt{t}\ \mathtt{else}\ \mathtt{t}$`|
|定数ゼロ|`$\mathtt{0}$`                                                                    |
|後者値  |`$\mathtt{succ}\ \mathtt{t}$`                                                     |
|前者値  |`$\mathtt{pred}\ \mathtt{t}$`                                                     |
|ゼロ判定|`$\mathtt{iszero}\ \mathtt{t}$`                                                   |

|値  |`$\mathtt{v}$`    |
|:---|:-----------------|
|真  |`$\mathtt{true}$` |
|偽  |`$\mathtt{false}$`|
|数値|`$\mathtt{nv}$`   |

|数値  |`$\mathtt{nv}$`               |
|:-----|:-----------------------------|
|ゼロ  |`$\mathtt{0}$`                |
|後者値|`$\mathtt{succ}\ \mathtt{nv}$`|

- `$\mathtt{pred}\ \mathtt{0}$` … 正しい
- `$\mathtt{pred}\ \mathtt{false}$` … 行き詰まり状態
    - 行き詰まり状態は，「無意味」「間違ったプログラム」に対応

**型の目的**

項を **実際に評価せず** に（静的チェック），その項が決して **行き詰まり状態にならない** ことを言いたい

2つの型を導入
- `$\mathtt{Bool}$`
- `$\mathtt{Nat}$`

メタ変数 `$\mathtt{S}$`, `$\mathtt{T}$`, `$\mathtt{U}$` は型の上を動くものとする．

**用語**
- 項 `$\mathtt{t}$` が型 `$\mathtt{T}$` を持つ
- `$\mathtt{t}$` が `$\mathtt{T}$` に属する
- `$\mathtt{t}$` は `$\mathtt{T}$` の要素である

`$\mathtt{t}$`を評価した結果が「明らかに」（静的に，`$\mathtt{t}$` を評価することなく）
適切な形の値になることを意味する

（例）
- `$\mathtt{if} \ \mathtt{true}\ \mathtt{then}\ \mathtt{false}\ \mathtt{else}\ \mathtt{true}$` は `$\mathtt{Bool}$` 型を持つ
- `$\mathtt{pred}\ (\mathtt{succ}\ (\mathtt{pred}\ (\mathtt{succ}\ \mathtt{0})))$` は `$\mathtt{Nat}$` 型を持つ

項の型の分析は **保守的** であり， **静的な情報のみ** を利用

（例）次の項を評価した場合
```mathjaxBlock
\begin{align}
                    & \mathtt{if}\ \underset{\mathtt{Bool}}{\underline{(\mathtt{iszero}\ \mathtt{0})}}\ \mathtt{then}\ \underset{\mathtt{Nat}}{\underline{\mathtt{0}}}\ \mathtt{else}\ \underset{\mathtt{Bool}}{\underline{\mathtt{false}}} \\
\longrightarrow\quad& \underset{\mathtt{Nat}}{\underline{\mathtt{0}}}
\end{align}
```
しかし，評価しない（静的な情報のみを利用する）ので，型を持てない．

（例）次の項を評価した場合
```mathjaxBlock
\begin{align}
                    & \mathtt{if}\ \underset{\mathtt{Bool}}{\underline{\mathtt{true})}}\ \mathtt{then}\ \underset{\mathtt{Nat}}{\underline{\mathtt{0}}}\ \mathtt{else}\ \underset{\mathtt{Bool}}{\underline{\mathtt{false}}} \\
\longrightarrow\quad& \underset{\mathtt{Nat}}{\underline{\mathtt{0}}}
\end{align}
```
同様に型を持てない．

Haskell では， `then` と `else` の型は同じでなければならない．


## 8.2 型付け関係

型付け関係は
```mathjaxBlock
\begin{align}
\mathtt{t:T}&& または&& \mathtt{t} \in \mathtt{T}
\end{align}
```

と書き，項に型を割り当てる **推論規則の集合** で定義される．

推論規則の集合

|型        |`$\mathtt{T}$`    |
|:---------|:-----------------|
|ブール値型|`$\mathtt{Bool}$` |
|自然数型  |`$\mathtt{Nat}$`  |

|型付け規則                                                                                                                                                                                                    |規則名  |
|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-------|
|`$\dfrac{}{\mathtt{true:Bool}}$`                                                                                                                                                                              |T-True  |
|`$\dfrac{}{\mathtt{false:Bool}}$`                                                                                                                                                                             |T-False |
|`$\dfrac{\mathtt{t}_{1}\mathtt{:Bool}\qquad \mathtt{t}_{2}\mathtt{:T}\qquad \mathtt{t}_{3}\mathtt{:T}}{\mathtt{if}\ \mathtt{t}_{1}\ \mathtt{then}\ \mathtt{t}_{2}\ \mathtt{else}\ \mathtt{t}_{3}\mathtt{:T}}$`|T-If    |
|`$\dfrac{}{\mathtt{0:Nat}}$`                                                                                                                                                                                  |T-Nat   |
|`$\dfrac{\mathtt{t}_{1}\mathtt{:Nat}}{\mathtt{succ}\ \mathtt{t}_{1}\mathtt{:Nat}}$`                                                                                                                           |T-Succ  |
|`$\dfrac{\mathtt{t}_{1}\mathtt{:Nat}}{\mathtt{pred}\ \mathtt{t}_{1}\mathtt{:Nat}}$`                                                                                                                           |T-Pred  |
|`$\dfrac{\mathtt{t}_{1}\mathtt{:Nat}}{\mathtt{iszero}\ \mathtt{t}_{1}\mathtt{:Bool}}$`                                                                                                                        |T-IsZero|

### 定義 8.2.1
型付け関係を形式的にいうと，

    算術式のための型付け関係は図 8-1 と図 8-2 における全てのインスタンス（定義3.5.1）を満たす，最小（定義3.2.1）の二項関係である．

**用語**
- 正しく型付けされている
- `$\mathtt{t}$` は型付け可能

項 `$\mathtt{t}$` に対して，ある型 `$\mathtt{T}$` が存在して `$\mathtt{t:T}$` となる．
